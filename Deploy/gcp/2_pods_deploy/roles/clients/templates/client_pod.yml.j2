apiVersion: v1
kind: Pod
metadata:
  name: "client{{ item }}"
  namespace: lsfs
  labels:
    lsfs: client
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: lsfs
            operator: In
            values:
            - client
  containers:
  - name: client-container
    image: brancc0cdocker/lsfs-client
#    command: [ "/bin/sh", "-c", "while true; do sleep 3600; done" ]
    command: ["./build/lsfs_exe"]
    args: ["{{ bootstrapper_ip }}", "1", "/shared_dir/conf.yaml", "client{{ item }}", "/test_filesystem/InnerFolder", "/test_filesystem/InnerFolder2"]
    securityContext:                                                                                      
      privileged: true
    volumeMounts:
    - mountPath: /shared_dir
      name: mount-volume
      mountPropagation: Bidirectional
    ports: 
    - containerPort: 12357
    - containerPort: 12358
  volumes:
  - hostPath:
      path: {{ mount_dir }}
    name: mount-volume