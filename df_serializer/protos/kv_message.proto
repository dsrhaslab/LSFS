syntax = "proto3";

package proto;

message get_latest_version_message {
  string ip = 1;
  int32 port = 2;
  int64 id = 3;
  string key = 4;
  string reqid = 5;
}

message get_latest_version_reply_message {
  string ip = 1;
  int32 port = 2;
  int64 id = 3;
  string reqid = 4;
  int64 version = 5;
}

message get_message {
  string ip = 1;
  int32 port = 2;
  int64 id = 3;
  string key = 4;
  oneof version_avail {
    bool version_none = 5;  // always set this to "true" when null
    int64 version = 6;
  }
  int64 version_client_id = 7;
  string reqid = 8;
}

message get_reply_message {
  string ip = 1;
  int32 port = 2;
  int64 id = 3;
  string key = 4;
  int64 version = 5;
  int64 version_client_id = 6;
  string reqid = 7;
  bytes data = 8;
}

message put_message {
  string ip = 1;
  int32 port = 2;
  int64 id = 3;
  string key = 4;
  int64 version = 5;
  bytes data = 6;
}

message put_with_merge_message {
  string ip = 1;
  int32 port = 2;
  int64 id = 3;
  string key = 4;
  int64 version = 5;
  bytes data = 6;
}

message put_reply_message {
  string ip = 1;
  int32 port = 2;
  int64 id = 3;
  string key = 4;
  int64 version = 5;
}

message kv_store_key {
  string key = 1;
  int64 version = 2;
  int64 client_id = 3;
}

message anti_entropy_message {
  string ip = 1;
  int32 port = 2;
  int64 id = 3;
  repeated kv_store_key keys = 4;
}

message kv_message {
    oneof msg {
        get_message                         get_msg = 1;
        get_reply_message                   get_reply_msg = 2;
        put_message                         put_msg = 3;
        put_with_merge_message              put_with_merge_msg = 4;
        put_reply_message                   put_reply_msg = 5;
        anti_entropy_message                anti_entropy_msg = 6;
        get_latest_version_message          get_latest_version_msg = 7;
        get_latest_version_reply_message    get_latest_version_reply_msg = 8;
    }
}